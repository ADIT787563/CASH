// Add after the last table in schema.ts

// Customers table for inbox
export const customers = sqliteTable('customers', {
  id: integer('id').primaryKey({ autoIncrement: true }),
  userId: text('user_id').notNull().references(() => user.id, { onDelete: 'cascade' }),
  phone: text('phone').notNull(),
  name: text('name'),
  email: text('email'),
  
  // Status and assignment
  status: text('status').notNull().default('new'), // new, active, hot, closed, lost, won
  assignedTo: text('assigned_to').references(() => user.id),
  
  // Tags and labels
  tags: text('tags', { mode: 'json' }).$type<string[]>(),
  labels: text('labels', { mode: 'json' }).$type<string[]>(),
  
  // Conversation tracking
  lastMessage: text('last_message'),
  lastMessageTime: text('last_message_time'),
  unreadCount: integer('unread_count').notNull().default(0),
  
  // Customer info
  notes: text('notes'),
  totalOrders: integer('total_orders').notNull().default(0),
  totalSpent: integer('total_spent').notNull().default(0),
  
  // Timestamps
  createdAt: text('created_at').notNull(),
  updatedAt: text('updated_at').notNull(),
});

// Conversation assignments table
export const conversationAssignments = sqliteTable('conversation_assignments', {
  id: integer('id').primaryKey({ autoIncrement: true }),
  customerId: integer('customer_id').notNull().references(() => customers.id, { onDelete: 'cascade' }),
  assignedTo: text('assigned_to').notNull().references(() => user.id),
  assignedBy: text('assigned_by').notNull().references(() => user.id),
  assignedAt: text('assigned_at').notNull(),
  notes: text('notes'),
});
